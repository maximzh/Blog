{% extends 'base.html.twig' %}
{% block body %}
    <div class="content-container center-block">
        <div class="clearfix">
            <div class="pull-left center-block homepage-body-container img-rounded">

                {% include 'AppBundle:Default:postsList.html.twig' %}

            </div>
            <div id="homepage-sidebar" class="pull-left img-rounded">

                {% if last_comments is not empty %}
                    <div id="last-comments-container">
                        <h3>Last comments:</h3>
                        {% for comment in last_comments %}
                            <h5>
                                {{ comment.commentAuthor }} ({{ comment.createdAt|date('d-m-Y') }})
                            </h5>
                            <a href="{{ path('show_post', {'slug': comment.post.slug}) }}">
                                {{ comment.text|length > 80 ? comment.text|slice(0, 80) ~ '...' :comment.text }}
                            </a>

                        {% endfor %}
                    </div>
                {% endif %}
                <div id="tag-cloud" class="bg-info">

                    {% for key,tag in tag_cloud %}
                        <a href="{{ path('show_tag', {'slug': tag.slug}) }}">
                            <span style="font-size: {{ tag.font }}px">{{ key }}</span>
                        </a>

                    {% endfor %}
                </div>
                <div>
                    {% if top_posts %}
                        <h3>Top 5 posts:</h3>
                        {% for post in top_posts %}
                            <p>
                                <a href="{{ path('show_post', {'slug': post.0.slug}) }}">
                                    {{ post.0.title }} (rating: {{ post.rating|number_format(2, '.', ',') }})
                                </a>
                            </p>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        function loadRows() {
            var url = $('.pagination span a').attr('href');
            $.get(url, function (data) {
                var content = $(data),
                        articlesList = content.closest('.blog-article'),
                        nextLink = content.find('.next-page');
                $('.homepage-body-container').append(articlesList);
                if (nextLink.length) {
                    $('.pagination').html(nextLink);
                } else {
                    $('.pagination').remove();
                }
            });
        }
        $(window).scroll(function () {
            if ($(window).scrollTop() == $(document).height() - $(window).height() && $('.pagination span a').length) {
                loadRows();
            }
        });
    </script>
{% endblock %}