{% extends '::admin_base.html.twig' %}

{% block body %}
{{ parent() }}
    <h1>
        <a href="{{ path('new_post') }}">Create new post</a>
    </h1>


    <table class="table table-striped table-hover admin-posts-table">
        <thead class="bg-info">
        <tr>
            <th>Post id</th>
            <th>Image</th>
            <th>Post title</th>
            <th>Author</th>
            <th>Created at</th>
            <th>Updated at</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
        </thead>

        <tbody class="posts-container">
        {% include 'AppBundle:Admin/Post:postsList.html.twig' %}
        </tbody>


    </table>


{% endblock %}
{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        function loadRows() {
            var url = $('.pagination span a').attr('href');
            $.get(url, function (data) {
                var content = $(data),
                        articlesList = content.closest('.posts'),
                        nextLink = content.find('.next-page');
                $('.posts-container').append(articlesList);
                if (nextLink.length) {
                    $('.pagination').html(nextLink);
                } else {
                    $('.pagination').remove();
                }
            });
        }
        $(window).scroll(function () {
            if ($(window).scrollTop() == $(document).height() - $(window).height() && $('.pagination span a').length) {
                loadRows();
            }
        });
    </script>
{% endblock %}
